"use strict";define("Build/DesignerExtensions/FileSelectPanel",["require","exports","react","Build/Common/Library/Legacy/Components/BranchDropdown","Build/Common/Library/Navigation","Build/Common/Library/RepositoryService","Build/Designer/Resources","VSS/Core/Util/String","VSS/Platform/Layout","VSSUI/ComboBox","VSSUI/FormItem","VSSUI/Icon","VSSUI/Link","VSSUI/MessageCard","VSSUI/Panel","VSSUI/Spinner"],function(e,t,i,s,o,r,a,n,l,d,c,p,h,g,m,u){!function(e){t.FileSelectPanel={},Object.defineProperty(t,"__esModule",{value:!0});class S extends l.VssComponent{constructor(e,t){super(e,t),this._onContinueClick=(()=>{this.props.onTemplateSelected(void 0,void 0,this.state.configurationFile,this.state.branch)}),this._onRenderOption=(e=>this.state.loadingFiles?i.createElement(u.Spinner,{size:"medium",label:a.LoadingYAMLFiles}):i.createElement("span",null,e.text)),this._getOptions=(()=>this.state.loadingFiles?[{key:"loading",text:"",disabled:!0}]:this.state.configFiles),this._setDataProviderError=(e=>{this.setState({dataProviderErrorMessage:e})}),this._setBranch=(e=>{this.setState({branch:e,configFiles:[],isValidFileFound:!1,loadingFiles:!0}),this._getConfigFiles(e)}),this._setPath=((e,t,i)=>{const s=e?e.text:i;s&&(this.setState({path:s,isValidFileFound:!1}),this._validateFile(s))}),this._onRepositoryClicked=(e=>{e.preventDefault(),this.props.wizardState.repositoryUrl&&o.openLinkSecurely(this.props.wizardState.repositoryUrl,!0)});const s={configFiles:[],loadingFiles:!0,branch:this.props.wizardState.branch,path:"",isValidFileFound:void 0,configurationFile:void 0,fileNotFoundErrorMessage:"",dataProviderErrorMessage:""};this.state=s}componentDidMount(){super.componentDidMount(),this._getConfigFiles(this.state.branch)}render(){const e=[{onClick:this.props.onDismiss,text:a.Cancel},{className:"primary-action-button",disabled:!this.state.isValidFileFound,onClick:this._onContinueClick,primary:!0,text:a.Continue}];return i.createElement("div",null,this.props.isOpen&&i.createElement(m.Panel,{ariaLabel:a.BringYourOwnYamlTitleShort,size:1,onDismiss:this.props.onDismiss,titleProps:{text:a.BringYourOwnYamlTitleShort},description:a.BringYourOwnYamlDesc,footerButtonProps:e,defaultActiveElement:s.branchDropdownComboBoxInputSelector},this._renderBody()))}_renderBody(){return i.createElement("div",{className:"ci-designer-file-select-panel-body flex-column flex-grow"},""!==this.state.dataProviderErrorMessage&&i.createElement(g.MessageCard,{className:"error",severity:"Error"},this.state.dataProviderErrorMessage),i.createElement(s.BranchDropdown,{className:"branch",label:a.Branch,repositoryType:this.props.wizardState.sourceProvider,repositoryId:this.props.wizardState.repositoryId,defaultBranch:this.state.branch,connectionId:this.props.wizardState.connectionId,onBranchSelected:this._setBranch,onError:this._setDataProviderError}),i.createElement(c.FormItem,{className:"path",label:a.Path,message:a.SelectYamlDescription},i.createElement(d.ComboBox,{options:this.state.configFiles,autoComplete:!0,allowFreeform:!0,errorMessage:this.state.fileNotFoundErrorMessage,onChanged:this._setPath,onRenderOption:this._onRenderOption,onResolveOptions:this._getOptions,text:this.state.path})),this.props.wizardState.repositoryUrl&&i.createElement(h.Link,{className:"repo-link flex-row",href:this.props.wizardState.repositoryUrl,onClick:this._onRepositoryClicked},this.props.wizardState.repositoryName,i.createElement(p.Icon,{className:"external-link-icon",iconName:"NavigateExternalInline"})))}_getConfigFiles(e){const t=this.context.pageContext.getService("IRepositoryService"),i={connectionId:this.props.wizardState.connectionId,sourceProviderType:this.props.wizardState.sourceProvider,id:this.props.wizardState.repositoryId,name:this.props.wizardState.repositoryName,projectId:this.props.wizardState.repositoryProjectId,defaultBranch:e};t.getConfigFiles(i,r.ConfigFileType.Yaml).then(e=>{const t=e.files.map(e=>({key:e,text:e}));this.setState({dataProviderErrorMessage:"",configFiles:t,loadingFiles:!1})},e=>{const t=e&&e.message||n.format(a.ConfigFileDataProviderErrorMessage,this.props.wizardState.repositoryName||this.props.wizardState.repositoryId);this.setState({dataProviderErrorMessage:t,loadingFiles:!1})})}_validateFile(e){const t=this.context.pageContext.getService("IVssContributionService"),i=Object.assign({},this.props.wizardState,{branch:this.state.branch,path:e});t.getDataAsync("ms.vss-build-web.existing-configuration-data-provider",i).then(e=>{e?this.setState({isValidFileFound:!0,configurationFile:e,fileNotFoundErrorMessage:""}):this.setState({isValidFileFound:!1,fileNotFoundErrorMessage:a.ConfigFileNotFound})},e=>{const t=e&&e.message||a.ConfigFileNotFound;this.setState({isValidFileFound:!1,fileNotFoundErrorMessage:t})})}}t.FileSelectPanel.FileSelectPanel=S,l.Components.add("designer-file-select-panel",S)}()},["FileSelectPanel"]),document.dispatchEvent(new CustomEvent("scriptLoaded",{cancelable:!1,detail:{id:"ms.vss-build-web.designer-extensions.file-select-panel"}}));